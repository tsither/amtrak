
% Track type 1
track_option(32800,(n,move_forward,n)).
track_option(32800,(n,wait,n)).
track_option(32800,(s,move_forward,s)).
track_option(32800,(s,wait,s)).

track_option(1025,(e,move_forward,e)).
track_option(1025,(e,wait,e)).
track_option(1025,(w,move_forward,w)).
track_option(1025,(w,wait,w)).

track_option(4608,(n,move_forward,w)).
track_option(4608,(n,wait,w)).
track_option(4608,(e,move_forward,s)).
track_option(4608,(e,wait,s)).

track_option(16386,(n,move_forward,e)).
track_option(16386,(n,wait,e)).
track_option(16386,(w,move_forward,s)).
track_option(16386,(w,wait,s)).

track_option(72,(s,move_forward,e)).
track_option(72,(s,wait,e)).
track_option(72,(w,move_forward,n)).
track_option(72,(w,wait,n)).

track_option(2064,(e,move_forward,n)).
track_option(2064,(e,wait,n)).
track_option(2064,(s,move_forward,w)).
track_option(2064,(s,wait,w)).


% Track type 6
track_option(20994,(n,move_right,e)).
track_option(20994,(n,wait,e)).
track_option(20994,(n,move_left,w)).
track_option(20994,(n,wait,w)).
track_option(20994,(n,wait,n)).
track_option(20994,(e,move_forward,s)).
track_option(20994,(e,wait,s)).
track_option(20994,(w,move_forward,s)).
track_option(20994,(w,wait,s)).

track_option(16458,(n,move_forward,e)).
track_option(16458,(n,wait,e)).
track_option(16458,(s,move_forward,e)).
track_option(16458,(s,wait,e)).
track_option(16458,(w,move_right,n)).
track_option(16458,(w,wait,n)).
track_option(16458,(w,move_left,s)).
track_option(16458,(w,wait,s)).
track_option(16458,(w,wait,w)).

track_option(2136,(e,move_forward,n)).
track_option(2136,(e,wait,n)).
track_option(2136,(s,move_left,e)).
track_option(2136,(s,wait,e)).
track_option(2136,(s,move_right,w)).
track_option(2136,(s,wait,w)).
track_option(2136,(s,wait,s)).
track_option(2136,(w,move_forward,n)).
track_option(2136,(w,wait,n)).

track_option(6672,(n,move_forward,w)).
track_option(6672,(n,wait,w)).
track_option(6672,(e,move_left,n)).
track_option(6672,(e,wait,n)).
track_option(6672,(e,move_right,s)).
track_option(6672,(e,wait,s)).
track_option(6672,(e,wait,e)).
track_option(6672,(s,move_forward,w)).
track_option(6672,(s,wait,w)).

% Track type 2
track_option(49186,(n,move_forward,n)).
track_option(49186,(n,wait,n)).
track_option(49186,(n,move_right,e)).
track_option(49186,(n,wait,e)).
track_option(49186,(n,wait,n)).
track_option(49186,(s,move_forward,s)).
track_option(49186,(s,wait,s)).
track_option(49186,(w,move_forward,s)).
track_option(49186,(w,wait,s)).

track_option(1097,(e,move_forward,e)).
track_option(1097,(e,wait,e)).
track_option(1097,(s,move_forward,e)).
track_option(1097,(s,wait,e)).
track_option(1097,(w,move_right,n)).
track_option(1097,(w,wait,n)).
track_option(1097,(w,move_forward,w)).
track_option(1097,(w,wait,w)).
track_option(1097,(w,wait,w)).

track_option(34864,(n,move_forward,n)).
track_option(34864,(n,wait,n)).
track_option(34864,(e,move_forward,n)).
track_option(34864,(e,wait,n)).
track_option(34864,(s,move_forward,s)).
track_option(34864,(s,wait,s)).
track_option(34864,(s,move_right,w)).
track_option(34864,(s,wait,w)).
track_option(34864,(s,wait,s)).

track_option(5633,(n,move_forward,w)).
track_option(5633,(n,wait,w)).
track_option(5633,(e,move_forward,e)).
track_option(5633,(e,wait,e)).
track_option(5633,(e,move_right,s)).
track_option(5633,(e,wait,s)).
track_option(5633,(e,wait,e)).
track_option(5633,(w,move_forward,w)).
track_option(5633,(w,wait,w)).

track_option(37408,(n,move_forward,n)).
track_option(37408,(n,wait,n)).
track_option(37408,(n,move_left,w)).
track_option(37408,(n,wait,w)).
track_option(37408,(n,wait,n)).
track_option(37408,(e,move_forward,s)).
track_option(37408,(e,wait,s)).
track_option(37408,(s,move_forward,s)).
track_option(37408,(s,wait,s)).

track_option(17411,(n,move_forward,e)).
track_option(17411,(n,wait,e)).
track_option(17411,(e,move_forward,e)).
track_option(17411,(e,wait,e)).
track_option(17411,(w,move_left,s)).
track_option(17411,(w,wait,s)).
track_option(17411,(w,move_forward,w)).
track_option(17411,(w,wait,w)).
track_option(17411,(w,wait,w)).

track_option(32872,(n,move_forward,n)).
track_option(32872,(n,wait,n)).
track_option(32872,(s,move_left,e)).
track_option(32872,(s,wait,e)).
track_option(32872,(s,move_forward,s)).
track_option(32872,(s,wait,s)).
track_option(32872,(s,wait,s)).
track_option(32872,(w,move_forward,n)).
track_option(32872,(w,wait,n)).

track_option(3089,(e,move_left,n)).
track_option(3089,(e,wait,n)).
track_option(3089,(e,move_forward,e)).
track_option(3089,(e,wait,e)).
track_option(3089,(e,wait,e)).
track_option(3089,(s,move_forward,w)).
track_option(3089,(s,wait,w)).
track_option(3089,(w,move_forward,w)).
track_option(3089,(w,wait,w)).

% Track type 3
track_option(33825,(n,move_forward,n)).
track_option(33825,(n,wait,n)).
track_option(33825,(e,move_forward,e)).
track_option(33825,(e,wait,e)).
track_option(33825,(s,move_forward,s)).
track_option(33825,(s,wait,s)).
track_option(33825,(w,move_forward,w)).
track_option(33825,(w,wait,w)).

% Track type 4
track_option(38433,(n,move_forward,n)).
track_option(38433,(n,wait,n)).
track_option(38433,(n,move_left,w)).
track_option(38433,(n,wait,w)).
track_option(38433,(n,wait,n)).
track_option(38433,(e,move_forward,e)).
track_option(38433,(e,wait,e)).
track_option(38433,(e,move_right,s)).
track_option(38433,(e,wait,s)).
track_option(38433,(e,wait,e)).
track_option(38433,(s,move_forward,s)).
track_option(38433,(s,wait,s)).
track_option(38433,(w,move_forward,w)).
track_option(38433,(w,wait,w)).

track_option(50211,(n,move_forward,n)).
track_option(50211,(n,wait,n)).
track_option(50211,(n,move_right,e)).
track_option(50211,(n,wait,e)).
track_option(50211,(n,wait,n)).
track_option(50211,(e,move_forward,e)).
track_option(50211,(e,wait,e)).
track_option(50211,(s,move_forward,s)).
track_option(50211,(s,wait,s)).
track_option(50211,(w,move_left,s)).
track_option(50211,(w,wait,s)).
track_option(50211,(w,move_forward,w)).
track_option(50211,(w,wait,w)).
track_option(50211,(w,wait,w)).

track_option(33897,(n,move_forward,n)).
track_option(33897,(n,wait,n)).
track_option(33897,(e,move_forward,e)).
track_option(33897,(e,wait,e)).
track_option(33897,(s,move_left,e)).
track_option(33897,(s,wait,e)).
track_option(33897,(s,move_forward,s)).
track_option(33897,(s,wait,s)).
track_option(33897,(s,wait,s)).
track_option(33897,(w,move_right,n)).
track_option(33897,(w,wait,n)).
track_option(33897,(w,move_forward,w)).
track_option(33897,(w,wait,w)).
track_option(33897,(w,wait,w)).

track_option(35889,(n,move_forward,n)).
track_option(35889,(n,wait,n)).
track_option(35889,(e,move_left,n)).
track_option(35889,(e,wait,n)).
track_option(35889,(e,move_forward,e)).
track_option(35889,(e,wait,e)).
track_option(35889,(e,wait,e)).
track_option(35889,(s,move_forward,s)).
track_option(35889,(s,wait,s)).
track_option(35889,(s,move_right,w)).
track_option(35889,(s,wait,w)).
track_option(35889,(s,wait,s)).
track_option(35889,(w,move_forward,w)).
track_option(35889,(w,wait,w)).

% Track type 5
track_option(38505,(n,move_forward,n)).
track_option(38505,(n,wait,n)).
track_option(38505,(n,move_left,w)).
track_option(38505,(n,wait,w)).
track_option(38505,(n,wait,n)).
track_option(38505,(e,move_forward,e)).
track_option(38505,(e,wait,e)).
track_option(38505,(e,move_right,s)).
track_option(38505,(e,wait,s)).
track_option(38505,(e,wait,e)).
track_option(38505,(s,move_left,e)).
track_option(38505,(s,wait,e)).
track_option(38505,(s,move_forward,s)).
track_option(38505,(s,wait,s)).
track_option(38505,(s,wait,s)).
track_option(38505,(w,move_right,n)).
track_option(38505,(w,wait,n)).
track_option(38505,(w,move_forward,w)).
track_option(38505,(w,wait,w)).
track_option(38505,(w,wait,w)).

track_option(52275,(n,move_forward,n)).
track_option(52275,(n,wait,n)).
track_option(52275,(n,move_right,e)).
track_option(52275,(n,wait,e)).
track_option(52275,(n,wait,n)).
track_option(52275,(e,move_left,n)).
track_option(52275,(e,wait,n)).
track_option(52275,(e,move_forward,e)).
track_option(52275,(e,wait,e)).
track_option(52275,(e,wait,e)).
track_option(52275,(s,move_forward,s)).
track_option(52275,(s,wait,s)).
track_option(52275,(s,move_right,w)).
track_option(52275,(s,wait,w)).
track_option(52275,(s,wait,s)).
track_option(52275,(w,move_left,s)).
track_option(52275,(w,wait,s)).
track_option(52275,(w,move_forward,w)).
track_option(52275,(w,wait,w)).
track_option(52275,(w,wait,w)).

node_track(T) :- C > 4, C = #count{ D: track_option(T,D) }, track_option(T, _).

option((X,Y),(IN,M,OUT)) :- track_option(Track, (IN,M,OUT)),  cell((X,Y), Track), not M=wait. % map the general track options to the current flatland environment in the form of 'option' atoms

cell_count(C) :- C = #count{ XY: cell((XY), Track), Track != 0}.


% each track ID is given a set of connections
% connection(ID, N/S, W/E, N/E, E/S, S/W, W/N)

% Track Type 1 - Straight
connection(32800,   1, 0, 0, 0, 0, 0).  % north to south
connection(1025,    0, 1, 0, 0, 0, 0).  % west to east

% Track Type 8 - Curve
connection(4608,    0, 0, 0, 0, 1, 0).  % south to west    
connection(16386,   0, 0, 0, 1, 0, 0).  % east to south
connection(72,      0, 0, 1, 0, 0, 0).  % north to east
connection(2064,    0, 0, 0, 0, 0, 1).  % west to north

% Track Type 2 - Simple switch (left)
connection(37408,   1, 0, 0, 0, 1, 0).
connection(17411,   0, 1, 0, 1, 0, 0).
connection(32872,   1, 0, 1, 0, 0, 0).
connection(3089,    0, 1, 0, 0, 0, 1).

% Track Type 9 - Simple switch (right)
connection(49186,   1, 0, 0, 1, 0, 0).
connection(1097,    0, 1, 1, 0, 0, 0).
connection(34864,   1, 0, 0, 0, 0, 1).
connection(5633,    0, 1, 0, 0, 1, 0).

% Track Type 3 - Diamond crossing
connection(33825,   1, 1, 0, 0, 0, 0).

% Track Type 4 - Single-slip switch
connection(38433,   1, 1, 0, 0, 1, 0).
connection(50211,   1, 1, 0, 1, 0, 0).
connection(33897,   1, 1, 1, 0, 0, 0).
connection(35889,   1, 1, 0, 0, 0, 1).

% Track Type 5 - Double-slip switch
connection(38505,   1, 1, 1, 0, 1, 0).
connection(52275,   1, 1, 0, 1, 0, 1).

% Track Type 6 - Symmetrical switch
connection(20994,   0, 0, 0, 1, 1, 0).
connection(16458,   0, 0, 1, 1, 0, 0).
connection(2136,    0, 0, 1, 0, 0, 1).
connection(6672,    0, 0, 0, 0, 1, 1).

%                                                  connection(ID, N/S, W/E, N/E, E/S, S/W, W/N)
node( N, (n, s)) :- cell(N,Track), node_track(Track), connection(Track, 1, _, _, _, _, _).
node( N, (w, e)) :- cell(N,Track), node_track(Track), connection(Track, _, 1, _, _, _, _).
node( N, (n, e)) :- cell(N,Track), node_track(Track), connection(Track, _, _, 1, _, _, _).
node( N, (e, s)) :- cell(N,Track), node_track(Track), connection(Track, _, _, _, 1, _, _).
node( N, (s, w)) :- cell(N,Track), node_track(Track), connection(Track, _, _, _, _, 1, _).
node( N, (w, n)) :- cell(N,Track), node_track(Track), connection(Track, _, _, _, _, _, 1).

node( N, (n, s)) :- cell(N,Track), start(_,N,_,_), connection(Track, 1, _, _, _, _, _).
node( N, (w, e)) :- cell(N,Track), start(_,N,_,_), connection(Track, _, 1, _, _, _, _).
node( N, (n, e)) :- cell(N,Track), start(_,N,_,_), connection(Track, _, _, 1, _, _, _).
node( N, (e, s)) :- cell(N,Track), start(_,N,_,_), connection(Track, _, _, _, 1, _, _).
node( N, (s, w)) :- cell(N,Track), start(_,N,_,_), connection(Track, _, _, _, _, 1, _).
node( N, (w, n)) :- cell(N,Track), start(_,N,_,_), connection(Track, _, _, _, _, _, 1).

node( N, (n, s)) :- cell(N,Track), end(_,N,_), connection(Track, 1, _, _, _, _, _).
node( N, (w, e)) :- cell(N,Track), end(_,N,_), connection(Track, _, 1, _, _, _, _).
node( N, (n, e)) :- cell(N,Track), end(_,N,_), connection(Track, _, _, 1, _, _, _).
node( N, (e, s)) :- cell(N,Track), end(_,N,_), connection(Track, _, _, _, 1, _, _).
node( N, (s, w)) :- cell(N,Track), end(_,N,_), connection(Track, _, _, _, _, 1, _).
node( N, (w, n)) :- cell(N,Track), end(_,N,_), connection(Track, _, _, _, _, _, 1).

node( N, (D2, D1)) :- node( N, (D1, D2)).